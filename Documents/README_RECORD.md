# 거래내역 서비스

## 거래내역 서비스 소개
* 거래내역 서비스는 입금, 송금, 거래 등이 다양한 금전 이벤트에 대한 거래내역을 저장하고 관리합니다.

## 요구사항
* 입금, 송금, 거래 등의 금전 이벤트 발생시 거래에 대한 제목을 저장한다.
* 타 서비스에 의존성을 두지 않기위해, 거래내역을 저장하거나 수정하는 등의 api는 모두 공통의 api를 사용한다.
* 즉 특정 서비스를 위한 거래내역 저장 api등을 만들지 않는다.
* 이에 따라 타 서비스로 부터 받아야하는 표준 json body를 아래에 정의했다.
* 거래내역은 소팅과 검색이 가능하며,
* 입금된 거래내역 소팅과 출금된 거래내역 소팅을 제공한다.
* 검색의 경우 연도로 검색이 가능하고, 연 + 월로 검색이 가능하다.(사실상 월 검색)
* 월단위 검색의 기본값은 조회 당일의 연도이다.
* 제목으로도 검색이 가능하다.
* 출금 거래내역의 경우 거래한 금액에 마이너스를 붙여서 저장한다.
* recordState가 입금, 출금, 취소 로 구분되고 입금이던 출금이던 해당 api를 호출하면 취소로 변경시킨다.
* 거래내역 취소가 가능한지 아닌지는 거래내역 서비스에서 검증하지 않는다. 
* 이에 대한 정책은 해당 api를 호출하는 마이크로 서비스에서 한다.
* 회원탈퇴시 거래내역은 자동 삭제된다.

## API 설계
```

```

## Json body 예시

## 서비스 간 통신
### 회원 탈퇴시 거래내역 삭제
```
KAFKA TOPIC : remove-record-belong-user
```

## 월 단위 검색
* 월단위 검색은 반드시 연도기입이 필요하다.
* 그 이유는 당연하게도 2022년에도 1월이 있고, 2023년에도 1월이 있고, 앞으로도 영원히 그러하기 때문이다.
* 따라서 월단위로 검색할 때에는 반드시 연도도 기입하여야한다.

## 거래내역 제목 표준 규격
### 입금
* 결제의 경우 : 구매자 + 입금
* 일반 입금 : 입금자 + 입금
### 출금
* 송금의 경우 : 송금받는 대상 + 송금
* 결제의 경우 : 결제상품 + 구매

[할일]
거래내역 서비스 회원탈퇴시 삭제 컨슈머 서비스
입금거래내역조회
출금거래내역조회
연검색
연 + 월검색 -> 기본연도는 해당년도
제목으로 검색

입금의 경우 그대로
출금의 경우 마이너스(-)기호 붙여서 저장

거래내역 상태 변경 api -> 입금, 송금, 거래 취소시
하나의 api에서 처리한다.
recordState가 입금, 출금, 취소 로 구분되고 입금이던 출금이던 해당 api를 호출하면 취소로 변경시킨다.
취소가 가능한지 아닌지는 거래내역 서비스에서 검증하지 않는다. 
이에 대한 정책은 해당 api를 호출하는 마이크로 서비스에서 한다.

[검색쿼리 + 파라미터 디폴드 참고 링크](https://github.com/liveforone/middle/tree/master/shop-service/shop-service/src/main/java/middle/shopservice/repository)

인덱스 걸기

표준 규격 문서화(해당 문서에)